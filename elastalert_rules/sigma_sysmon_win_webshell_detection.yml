alert:
- debug
description: Detects certain command line parameters often used during reconnaissance activity via web shells
filter:
- query:
    query_string:
      query: (data.win.system.eventID:"1" AND (data.win.eventdata.parentImage:(*\\w3wp.exe OR *\\php\-cgi.exe OR *\\nginx.exe OR *\\httpd.exe) OR data.win.eventdata.parentImage:(*\\apache* OR *\\tomcat*)) AND (data.win.system.eventID:"1" AND (((data.win.eventdata.image:(*\\net.exe OR *\\net1.exe) AND data.win.eventdata.commandLine:(*\ user\ * OR *\ use\ * OR *\ group\ *)) OR (data.win.eventdata.image:*\\ping.exe AND data.win.eventdata.commandLine:*\ \-n\ *) OR data.win.eventdata.commandLine:(*&cd&echo* OR *cd\ \/d\ *)) OR (data.win.eventdata.image:*\\wmic.exe AND data.win.eventdata.commandLine:*\ \/node\:*) OR data.win.eventdata.image:(*\\whoami.exe OR *\\systeminfo.exe OR *\\quser.exe OR *\\ipconfig.exe OR *\\pathping.exe OR *\\tracert.exe OR *\\netstat.exe OR *\\schtasks.exe OR *\\vssadmin.exe OR *\\wevtutil.exe OR *\\tasklist.exe) OR data.win.eventdata.commandLine:(*\ Test\-NetConnection\ * OR *dir\ \\*))))
index: wazuh-alerts-3.x-*
name: Webshell-Detection-With-Command-Line-Keywords
priority: 2
realert:
  minutes: 0
type: any


