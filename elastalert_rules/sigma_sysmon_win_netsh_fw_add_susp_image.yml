alert:
- debug
description: Detects Netsh commands that allows a suspcious application location on Windows Firewall
filter:
- query:
    query_string:
      query: (data.win.system.eventID:"1" AND (data.win.system.eventID:"1" AND data.win.eventdata.image:*\\netsh.exe AND data.win.eventdata.commandLine:*firewall* AND data.win.eventdata.commandLine:*add* AND (data.win.eventdata.commandLine:*allowedprogram* OR (data.win.eventdata.commandLine:*advfirewall* AND data.win.eventdata.commandLine:*rule* AND data.win.eventdata.commandLine:*action\=allow* AND data.win.eventdata.commandLine:*program\=*))) AND (data.win.eventdata.commandLine:(*%TEMP%* OR *\:\\RECYCLER\\* OR *C\:\\$Recycle.bin\\* OR *\:\\SystemVolumeInformation\\* OR *C\:\\Windows\\Temp\\* OR *C\:\\Temp\\* OR *C\:\\Users\\Public\\* OR *C\:\\Users\\Default\\* OR *C\:\\Users\\Desktop\\* OR *\\Downloads\\* OR *\\Temporary\ Internet\ Files\\Content.Outlook\\* OR *\\Local\ Settings\\Temporary\ Internet\ Files\\*) OR data.win.eventdata.commandLine:(C\:\\Windows\\Tasks\\* OR C\:\\Windows\\debug\\* OR C\:\\Windows\\fonts\\* OR C\:\\Windows\\help\\* OR C\:\\Windows\\drivers\\* OR C\:\\Windows\\addins\\* OR C\:\\Windows\\cursors\\* OR C\:\\Windows\\system32\\tasks\\* OR %Public%\\*)))
index: wazuh-alerts-3.x-*
name: Netsh-Program-Allowed-with-Suspcious-Location
priority: 2
realert:
  minutes: 0
type: any


