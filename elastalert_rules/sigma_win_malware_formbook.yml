alert:
- debug
description: Detects Formbook like process executions that inject code into a set of files in the System32 folder, which executes a special command command line to delete the dropper from the AppData Temp folder. We avoid false positives by excluding all parent process with command line parameters.
filter:
- query:
    query_string:
      query: (data.win.system.eventID:"4688" AND data.win.eventdata.parentCommandLine:(C\:\\Windows\\System32\\* OR C\:\\Windows\\SysWOW64\\*) AND data.win.eventdata.parentCommandLine:(*.exe) AND data.win.eventdata.commandLine:*C\:\\Users\\* AND ((data.win.eventdata.commandLine:*\/c* AND data.win.eventdata.commandLine:*del* AND data.win.eventdata.commandLine:*\\AppData\\Local\\Temp\\*) OR (data.win.eventdata.commandLine:*\/c* AND data.win.eventdata.commandLine:*del* AND data.win.eventdata.commandLine:*\\Desktop\\*) OR (data.win.eventdata.commandLine:*\/C* AND data.win.eventdata.commandLine:*type\ nul\ >* AND data.win.eventdata.commandLine:*\\Desktop\\*)) AND data.win.eventdata.commandLine:*.exe)
index: wazuh-alerts-3.x-*
name: Formbook-Process-Creation
priority: 1
realert:
  minutes: 0
type: any


