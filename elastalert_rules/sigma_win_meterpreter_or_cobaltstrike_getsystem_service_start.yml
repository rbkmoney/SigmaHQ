alert:
- debug
description: Detects the use of getsystem Meterpreter/Cobalt Strike command by detecting a specific service starting
filter:
- query:
    query_string:
      query: (data.win.system.eventID:"4688" AND (data.win.eventdata.parentImage:*\\services.exe AND ((data.win.eventdata.commandLine:*cmd* AND data.win.eventdata.commandLine:*\/c* AND data.win.eventdata.commandLine:*echo* AND data.win.eventdata.commandLine:*\\pipe\\*) OR (data.win.eventdata.commandLine:*%COMSPEC%* AND data.win.eventdata.commandLine:*\/c* AND data.win.eventdata.commandLine:*echo* AND data.win.eventdata.commandLine:*\\pipe\\*) OR (data.win.eventdata.commandLine:*cmd.exe* AND data.win.eventdata.commandLine:*\/c* AND data.win.eventdata.commandLine:*echo* AND data.win.eventdata.commandLine:*\\pipe\\*) OR (data.win.eventdata.commandLine:*rundll32* AND data.win.eventdata.commandLine:*.dll,a* AND data.win.eventdata.commandLine:*\/p\:*))) AND (NOT (data.win.eventdata.commandLine:*MpCmdRun*)))
index: wazuh-alerts-3.x-*
name: Meterpreter-or-Cobalt-Strike-Getsystem-Service-Start
priority: 2
realert:
  minutes: 0
type: any


